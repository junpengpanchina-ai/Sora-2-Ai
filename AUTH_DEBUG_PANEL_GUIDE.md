# 🔍 登录状态调试面板使用指南

## 📊 功能说明

已创建一个实时调试面板，显示所有登录相关的状态和事件。

## 🎯 面板位置

调试面板位于页面**右下角**，是一个可收缩的蓝色面板。

## 📋 显示的信息

### 1. **当前状态概览**

面板顶部显示：
- ✅ **NextAuth 状态**：authenticated / loading / unauthenticated
- ✅ **NextAuth 用户**：当前登录用户的邮箱
- ✅ **Simple Auth 加载状态**：是否正在加载
- ✅ **Simple Auth 用户**：当前用户的邮箱

### 2. **实时事件日志**

面板会记录并显示：

- 🔵 **页面焦点事件**：页面获得/失去焦点
- 👁️ **页面可见性变化**：页面显示/隐藏
- 🔄 **定期 Session 检查**：每5秒自动检查一次
- 📡 **NextAuth Session 变化**：NextAuth session 状态更新
- 📡 **Simple Auth 状态变化**：Simple Auth 状态更新

### 3. **操作按钮**

- 🔄 **刷新并重载**：手动检查 session 并刷新页面
- 🗑️ **清除日志**：清空日志记录

## 🧪 如何使用调试面板

### 步骤 1: 查看初始状态

打开页面后，调试面板会自动显示：
- 当前是否已登录
- 使用的认证方式（NextAuth 或 Simple Auth）

### 步骤 2: 测试 Google 登录

1. 点击 "Continue with Google"
2. 完成 Google 授权
3. **观察调试面板**：
   - 应该看到 "页面可见性变化" 事件
   - 应该看到 "NextAuth Session 状态变化"
   - 应该看到 "Simple Auth 状态变化"
   - 状态应该更新为 "authenticated"

### 步骤 3: 检查登录后状态

如果登录后状态没有更新：

1. **查看日志**：
   - 是否显示 "NextAuth Session 状态变化"？
   - Session 数据是什么？
   - Simple Auth 是否检测到了用户？

2. **手动刷新**：
   - 点击 "🔄 刷新并重载" 按钮
   - 查看是否更新

### 步骤 4: 测试登出

1. 点击 "Logout" 按钮
2. **观察调试面板**：
   - 应该看到状态变化
   - Session 应该被清除
   - 用户应该变为 "无"

## 🔍 常见问题诊断

### Q1: 登录后状态没有更新？

**检查**：
- 日志中是否有 "NextAuth Session 状态变化"？
- NextAuth Session 数据中是否有 `user` 字段？
- Simple Auth 是否检测到了用户？

**可能原因**：
- NextAuth session 检查失败
- `useSimpleAuth` hook 没有正确更新状态
- 页面没有自动刷新 session

### Q2: 登出后还是显示已登录？

**检查**：
- 日志中是否有登出相关的事件？
- NextAuth Session 是否被清除？
- Simple Auth Session 是否被清除？

**可能原因**：
- NextAuth `signOut` 没有正确执行
- Cookie 没有被清除
- 页面状态没有刷新

### Q3: 状态变化但页面没有更新？

**检查**：
- 日志中显示状态已变化，但 UI 没有更新？

**解决方案**：
- 点击 "🔄 刷新并重载" 按钮
- 或手动刷新页面（F5）

## 📝 日志格式

每条日志包含：
- **时间戳**：事件发生的时间
- **事件名称**：事件的描述
- **数据**：事件的详细信息（JSON 格式）

示例：
```
🔵 页面获得焦点
2024-01-15 14:30:25
{
  "time": "2024-01-15T14:30:25.123Z"
}
```

## 🎨 面板样式

- **蓝色头部**：面板标题
- **灰色状态区**：当前状态概览
- **白色日志区**：事件日志列表
- **可收缩**：点击右上角 × 收起，右下角按钮展开

## ⚙️ 调试技巧

1. **保持面板打开**：在进行登录/登出操作时保持调试面板可见

2. **观察日志顺序**：
   - 事件按时间倒序显示（最新的在上）
   - 查看事件的时间顺序可以帮助理解问题

3. **检查 Session 数据**：
   - 点击展开日志中的 JSON 数据
   - 查看 session 对象的完整内容

4. **比较状态变化**：
   - 登录前记录初始状态
   - 登录后对比状态变化
   - 找出哪里没有更新

---

**提示**：如果发现问题，请提供调试面板中的日志信息，这样可以帮助快速定位问题。
