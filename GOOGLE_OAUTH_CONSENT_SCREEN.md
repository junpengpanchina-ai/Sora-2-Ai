# ✅ Google OAuth 同意屏幕配置检查

## 🔗 直接访问链接

**访问 OAuth 同意屏幕设置**：
```
https://console.cloud.google.com/apis/credentials/consent?project=skilled-acolyte-476516-g8
```

或者手动导航：
1. 打开 [Google Cloud Console](https://console.cloud.google.com/)
2. 选择项目：`skilled-acolyte-476516-g8`
3. 左侧菜单：**"API和服务"** > **"OAuth 同意屏幕"**

## 📋 配置检查清单

### 步骤 1: 检查应用信息（App Information）

**必须完成的配置项**：

1. **用户类型 / User Type**
   - ✅ **外部** - 适用于所有 Google 用户（推荐用于开发）
   - ⚠️ **内部** - 仅适用于您组织内的用户
   - **建议选择：外部**（除非是组织内部应用）

2. **应用名称 / App name**
   - ✅ 必须有名称，例如：`Sora AI Platform` 或 `AI Video Generator`
   - ⚠️ 不能为空

3. **用户支持电子邮件 / User support email**
   - ✅ 必须填写有效的邮箱地址
   - 例如：`support@yourdomain.com` 或您的个人邮箱

4. **应用徽标 / App logo**（可选）
   - ⚠️ 可选，但建议上传以获得更好的用户体验

5. **应用主页链接 / Application home page**（可选）
   - ⚠️ 可选，可以填写：`http://localhost:3000`

6. **应用隐私政策链接 / Application privacy policy link**（可选）
   - ⚠️ 开发阶段可以填写占位符：`http://localhost:3000/privacy`
   - ⚠️ 生产环境必须有真实的隐私政策页面

7. **应用服务条款链接 / Application terms of service link**（可选）
   - ⚠️ 开发阶段可以填写占位符：`http://localhost:3000/terms`
   - ⚠️ 生产环境必须有真实的服务条款页面

8. **已获授权的网域 / Authorized domains**（可选）
   - ⚠️ 开发阶段可以留空
   - ⚠️ 生产环境需要添加您的域名

**✅ 检查状态**：页面顶部应该显示绿色的勾选标记或"已完成"状态

---

### 步骤 2: 检查作用域（Scopes）

**必须添加的作用域**：

Google OAuth 登录需要的基本作用域：

1. **电子邮件 / email**
   - ✅ 必须添加
   - 用途：获取用户的电子邮件地址

2. **个人资料 / profile**
   - ✅ 必须添加
   - 用途：获取用户的基本个人信息（姓名、头像等）

3. **公开个人资料 / openid**
   - ✅ 应该已自动添加（通过 OpenID Connect）

**如何检查**：

- 查看"作用域"页面
- 应该至少看到：
  ```
  email
  profile
  openid
  ```

**如果没有这些作用域**：
1. 点击"添加或移除作用域"
2. 勾选：
   - `.../auth/userinfo.email`
   - `.../auth/userinfo.profile`
   - `openid`
3. 保存

---

### 步骤 3: 检查测试用户（Test Users）

**开发阶段必须添加测试用户**：

在应用处于"测试"状态时，只有添加到"测试用户"列表的用户才能登录。

**如何添加测试用户**：

1. 在"测试用户"部分
2. 点击 **"+ 添加用户"**
3. 输入您的 Google 账户邮箱（用于测试的邮箱）
4. 点击"添加"

**✅ 检查状态**：
- 应该至少有一个测试用户邮箱
- 这个邮箱就是您用来测试 Google 登录的账户

**⚠️ 重要**：
- 如果您尝试用未添加到测试用户列表的账户登录，Google 会显示"访问被拒绝"错误
- 如果应用已发布，则所有用户都可以登录（不需要添加到测试用户列表）

---

### 步骤 4: 检查应用状态（App Status）

**应用发布状态**：

1. **测试中 / Testing**
   - ⚠️ 只有添加到测试用户列表的用户可以登录
   - ✅ 适合开发阶段使用

2. **已发布 / In production**
   - ✅ 所有 Google 用户都可以登录
   - ⚠️ 需要完成更多配置（隐私政策、服务条款等）

**如何检查**：
- 在同意屏幕页面的顶部或底部可以看到应用状态
- 应该显示："测试中" 或 "已发布"

**开发阶段建议**：
- 保持为"测试中"状态
- 添加您自己的 Google 账户作为测试用户

---

### 步骤 5: 检查摘要（Summary）

**最终检查**：

在同意屏幕设置完成后，应该有一个"摘要"页面，显示：

✅ **应用信息** - 已完成
✅ **作用域** - 已完成
✅ **测试用户** - 已完成（至少一个用户）
✅ **摘要** - 所有配置已保存

---

## 🔍 快速检查方法

### 方法 1: 查看配置进度

在 OAuth 同意屏幕页面的顶部，应该显示：
- ✅ 应用信息：已完成
- ✅ 作用域：已完成
- ⚠️ 测试用户：需要至少添加一个用户

### 方法 2: 尝试保存

如果所有必填项都已完成，可以：
1. 滚动到页面底部
2. 点击"保存并继续"或"保存"
3. 如果显示错误提示，说明还有未完成的配置

### 方法 3: 查看警告信息

Google 会在页面顶部显示：
- ⚠️ 黄色警告：需要完成的配置
- ✅ 绿色提示：配置已完成
- ❌ 红色错误：必须修复的问题

---

## 🚀 最小配置（用于开发和测试）

**快速配置清单**（最少需要这些才能工作）：

1. ✅ **用户类型**：选择"外部"
2. ✅ **应用名称**：填写任意名称（如：`Sora AI Platform`）
3. ✅ **用户支持电子邮件**：填写您的邮箱
4. ✅ **作用域**：确保有 `email` 和 `profile`
5. ✅ **测试用户**：添加您用于测试的 Google 账户邮箱
6. ✅ **保存**所有配置

**隐私政策和服务条款**（可选，但建议填写占位符）：
- 隐私政策：`http://localhost:3000/privacy`
- 服务条款：`http://localhost:3000/terms`

---

## ❓ 常见问题

### Q1: 如果我没有完成同意屏幕配置会怎样？

**A**: Google OAuth 登录会失败，显示错误：
- `Error 400: redirect_uri_mismatch`（即使 URI 配置正确）
- `Error 403: access_denied`
- `Error: invalid_client`

### Q2: 为什么需要添加测试用户？

**A**: 当应用处于"测试"状态时，Google 只允许测试用户登录。这是 Google 的安全措施。

### Q3: 可以跳过某些步骤吗？

**A**: 
- ❌ 不能跳过：应用名称、用户支持电子邮件、测试用户
- ⚠️ 可以跳过但建议填写：隐私政策、服务条款（开发阶段可以用占位符）

### Q4: 如何知道配置是否完成？

**A**: 
- 访问同意屏幕页面，应该看到所有步骤都已标记为完成
- 尝试保存，如果没有错误提示，说明配置完成

---

## 🔗 相关链接

- **OAuth 同意屏幕设置**：
  ```
  https://console.cloud.google.com/apis/credentials/consent?project=skilled-acolyte-476516-g8
  ```

- **OAuth 客户端凭据**：
  ```
  https://console.cloud.google.com/apis/credentials?project=skilled-acolyte-476516-g8
  ```

---

## ✅ 配置完成后

完成所有配置后：

1. **等待 1-2 分钟**（Google 可能需要时间同步）
2. **重启开发服务器**（如果正在运行）
3. **测试 Google 登录**：
   - 访问登录页面
   - 点击 "Continue with Google"
   - 应该能跳转到 Google 授权页面

---

**关键提示**：OAuth 同意屏幕的配置是 Google OAuth 登录的关键步骤之一。即使 OAuth 客户端配置完全正确，如果同意屏幕未完成，登录也会失败。
